# 멀티프로세싱

멀티 프로세싱이란, 다수의 프로세서가 협력적으로 일을 처리하는 것을 의미합니다.

- 프로세서 : CPU 나 Microprocessor 라는 하드웨어를 의미
- 프로세스 : 실제 메모리에 적재되어 프로세서에 의해 실행되고 있는 프로그램

보통 하나의 프로세서가 하나의 작업을 맡지만 멀티 프로세싱은 다수의 프로세서가 다수의 작업을 함께 처리하는 것을 의미합니다.

<img width="503" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-10-20_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_2 46 27" src="https://user-images.githubusercontent.com/67513311/196779127-e3f1d0ee-2ba1-40ab-829b-59f0f2ae8382.png">

멀티프로세싱은 특정 프로세서에 문제가 발생되더라도 다른 프로세스를 이용해서 처리할 수 있으므로 신뢰성이 높다는 장점이 있습니다. 또한 여러 개의 프로세스가 처리되어야 할 때 동일한 데이터를 사용한다면 각 프로세서에게 할당할 필요없이 하나의 공간에 데이터를 저장한 후 이를 공유하여 사용하도록 한다면 비용을 절약할 수 있습니다.

## 웹 브라우저

웹 브라우저는 멀티프로세스 구조를 가지고 있으며 다음과 같습니다.

- 브라우저 프로세스 : 앞뒤로 가기, 주소 표시줄, 네트워크 통신 등을 담당
- 렌더러 프로세스 : 보이는 모든 것을 제어
- 플러그인 프로세스 : 웹 사이트에서 사용하는 플러그인 제어
- GPU 프로세스 : GPU 를 이용해서 화면을 그리는 부분을 제어

## IPC(Inter Process Communication)

프로세스는 완전히 독립된 실행 객체입니다. 서로 독립되어 있다는 것은 하나의 프로세스가 다른 프로세스의 영향을 받지 않는다는 장점이 있습니다. 그러나 독립되어 있는 만큼 별도의 설비가 없이는 서로간에 통신이 어렵다는 문제가 있습니다. 이를 위해서 커널 영역에서 IPC 라는 내부 프로세스간 통신을 제공하게 되고, 프로세스는 커널이 제공하는 IPC 설비를 이용해서 프로세스간 통신을 할 수 있게 됩니다. 즉 IPC 는 프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 메커니즘을 의미합니다.

- **유저 영역** : 프로그램이 동작하기 위해 사용되는 메모리 공간(코드 영역, 데이터 영역, 스택 및 힙 영역) 을 가리켜 유저 영역이라고 합니다.
- **커널 영역** : 하나의 프로세스에 할당되는 총 메모리 공간 중에서 유저 영역을 제외한 나머지 영역을 커널 영역이라고 합니다. 운영체제가 실행될 때의 모드로, 메모리뿐만 아니라, 하드웨어의 접근에도 제한이 따르지 않습니다.
- 일반 프로그램을 실행시키기 위해서 필요한 메모리 공간과 운영체제의 실행을 위한 메모리 공간을 분리시켜 놓지 않으면 관리하기 힘들어집니다. 따라서 유저 영역과 커널 영역을 분리합니다. 유저 모드와 커널 모드를 제공하는 것은 운영체제가 아니라 프로세서입니다.

IPC 에도 아래와 같은 다양한 설비들이 존재합니다. 각각의 설비는 상황에 맞게 선택을 해야하며, 잘못된 IPC 의 선택은 코딩과정을 어렵게 만들거나 프로그램 작동을 효율적이지 못하게 만들 수 있습니다. IPC 의 종류로는 공유 메모리, 파일, 소켓, 익명 파이프, 명명 파이프, 메시지 큐가 있습니다. 이들은 모두 메모리가 완전히 공유되는 스레드 보다 속도가 떨어집니다.

- **공유메모리 (Shared Memory)**
    - 데이터를 공유하는 방법에는 크게 두 가지가 있습니다. 하나는 통신을 이용해서 데이터를 주고 받는 것이고 다른 하나는 데이터를 아예 같은 공간에 두고 함께 사용하는 것입니다. PIPE, Named PIPE, Message Queue 가 통신을 위한 설비라면, Shared Memory 는 공유 메모리가 데이터 자체를 공유하도록 지원하는 설비입니다.
    - 기본적으로 프로세스는 자신만의 메모리 영역을 가지고 있습니다. 이 메모리 영역은 다른 프로세스가 접근해서 함부로 데이터를 읽거나 쓰지 못하도록 커널에 의해서 보호가 되는데, 만약 다른 프로세스의 메모리 영역을 침범하려고 하면 커널은 침범 프로세스에게 SIGSEGV(범위를 벗어나는 메모리 접근 경고)를 보냅니다. 하지만 스레드처럼 메모리 영역을 공유한다면 더 편하게 데이터를 함께 사용할 수 있을 것이고 이를 허용하는 메모리를 공유 메모리 (Shared Memory) 라고 합니다. 공유 메모리는 중개자 없이 바로 접근할 수 있기 때문에 모든 IPC 가운데 가장 빠르게 작동합니다.
- **파일 (File)**
    - 파일은 디스크에 저장된 데이터 또는 파일 서버에서 제공한 데이터를 말합니다. 이를 기반으로 프로세스 간 통신을 합니다.
- **소켓 (Socket)**
    - 동일한 컴퓨터의 다른 프로세스나 네트워크의 다른 컴퓨터로 네트워크 인터페이스를 통해 전송하는 데이터를 의미하며 TCP 와 UDP 가 있습니다.
- **익명 파이프 (PIPE)**
    
    
![Untitled](https://user-images.githubusercontent.com/67513311/196779372-e4e4fcb4-b5fa-4194-aec7-de7bba967cc9.png)

    
    - 파이프는 두 개의 프로세스를 연결하고, 이 때 하나의 프로세스는 데이터 쓰기만, 다른 하나는 데이터 읽기만 가능합니다. 만약 읽기와 쓰기를 모두 원한다면 두 개의 파이프를 만들어야 가능해집니다. 하지만 두 개의 파이프를 만드는 것은 구현이 복잡해질 수 있습니다.
    - 파이프는 매우 간단하게 사용할 수 있다는 장점이 있습니다. 만약 한쪽 프로세스가 단지 읽기만 하고 다른 쪽 프로세스는 단지 쓰기만 하는 단순한 흐름이라면 PIPE 를 사용하면 됩니다.
    - 통신을 할 프로세스를 명확히 알고 있는 경우, 예를 들어 부모, 자식 프로세스 간에만 사용할 수 있으며 다른 네트워크 상에서는 사용이 불가능합니다.
- **명명된 파이프 (Named PIPE)**
    - **Named PIPE** 는 PIPE 와 다르게 부모 자식 관계의 프로세스가 아닌 전혀 다른 모든 프로세스들 사이에서 통신이 가능한 PIPE 의 확장 개념입니다. 그것이 가능한 이유는 프로세스 통신을 위해 이름이 있는 파일을 사용하기 때문입니다.
    - **Named PIPE 또한 PIPE 처럼 단방향 통신만 가능하다는 단점이 있지만 통신 선로가 파일로 존재하므로 하나를 읽기 전용으로 열고 다른 하나를 쓰기 전용으로 열어서 문제를 해결할 수 있습니다.**
- **메시지 큐 (Message Queue)**
    - Queue 는 선입선출의 자료구조를 가지는 통신설비로 커널에서 관리합니다. 입출력 방식으로만 보면 Named PIPE 와 동일하다고 볼 수 있지만, 차이점은 Named PIPE 가 데이터의 흐름이라면 메시지 큐는 메모리 공간이라는 점입니다. 파이프가 아닌, 어디에서나 물건을 꺼낼 수 있는 컨베이어 벨트라고 볼 수 있습니다. 컨베이어 벨트에 올라간 물건에 라벨을 붙여서 여러 물건을 동시에 올릴 수 있는 것처럼, 메시지 큐에 쓸 데이터에 번호를 붙임으로써 여러 개의 프로세스가 동시에 데이터를 쉽게 다룰 수 있습니다.
        - 공유 메모리와 다르게 통신 설비 내에서 메모리 공간을 사용하는 것
    - 공유 메모리를 통해 IPC 를 구현할 때 쓰기 및 읽기 빈도가 높으면 동기화 때문에 기능을 구현하는 것이 매우 복잡해지는데, 이때 대안으로 메시지 큐를 사용하기도 합니다.
